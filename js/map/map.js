(function(){
    "use strict";

    var map,
        currentLocation,
        currentAtm,
        iconSize = 0.1;

    function showItem(index) {
        var atmIcon= {
                path: "M396.616,0H44.275C20.703,0,1.525,19.177,1.525,42.75v73.43c0,23.573,19.178,42.75,42.75,42.75h13.905v266.961,c0,8.284,6.716,15,15,15h294.531c8.284,0,15-6.716,15-15V158.93h13.904c23.572,0,42.75-19.177,42.75-42.75V42.75,C439.366,19.177,420.188,0,396.616,0z M88.181,89.466h264.531v270.41c-25.34,5.722-45.327,25.687-51.082,51.015H139.261,c-5.755-25.327-25.741-45.292-51.081-51.015V89.466z M88.181,380.602c14.288,4.717,25.602,16.013,30.346,30.289H88.181V380.602z,M322.364,410.891c4.744-14.277,16.058-25.572,30.347-30.29v30.29H322.364z M409.366,116.18c0,7.03-5.72,12.75-12.75,12.75h-24.17,V89.466h16c5.522,0,10-4.477,10-10s-4.478-10-10-10h-336c-5.523,0-10,4.477-10,10s4.477,10,10,10h16v39.464H44.275,c-7.03,0-12.75-5.72-12.75-12.75V42.75c0-7.031,5.72-12.75,12.75-12.75h352.34c7.03,0,12.75,5.719,12.75,12.75V116.18z,M200.844,222.491c13.435,0,24.766-9.164,28.082-21.569h26.937c-2.496,3.94-6.883,6.569-11.882,6.569,c-4.143,0-7.5,3.358-7.5,7.5s3.357,7.5,7.5,7.5c13.436,0,24.767-9.164,28.083-21.569h3.479c4.143,0,7.5-3.358,7.5-7.5,s-3.357-7.5-7.5-7.5h-3.479c-3.316-12.404-14.647-21.569-28.083-21.569c-13.435,0-24.766,9.164-28.082,21.569h-26.937,c2.496-3.94,6.883-6.569,11.882-6.569c4.142,0,7.5-3.358,7.5-7.5s-3.358-7.5-7.5-7.5c-13.436,0-24.767,9.164-28.083,21.569h-3.479,c-4.142,0-7.5,3.358-7.5,7.5s3.358,7.5,7.5,7.5h3.479C176.078,213.327,187.408,222.491,200.844,222.491z M200.844,207.491,c-4.999,0-9.386-2.629-11.882-6.569h23.764C210.23,204.862,205.843,207.491,200.844,207.491z M243.981,179.354,c4.999,0,9.386,2.629,11.882,6.569h-23.764C234.595,181.983,238.982,179.354,243.981,179.354z,M222.412,285.682c50.872,0,92.26-41.387,92.26-92.26s-41.388-92.26-92.26-92.26s-92.26,41.387-92.26,92.26,S171.54,285.682,222.412,285.682z M222.412,121.163c39.844,0,72.26,32.416,72.26,72.26s-32.416,72.26-72.26,72.26,c-39.844,0-72.26-32.416-72.26-72.26S182.568,121.163,222.412,121.163z",
                fillColor: '#FF0000',
                fillOpacity: 1,
                anchor: new google.maps.Point(200,200),
                strokeWeight: 0,
                scale: iconSize
            },
            menu = document.querySelector(".list-wrapper"),
            closeBtn = document.querySelector(".show-wrapper-btn"),
            utility = window.atm.utility;;

        if(currentAtm) {
            currentAtm.setMap(null);
        }

        currentAtm = new google.maps.Marker({
            position: window.atm.atms[index].location,
            map: map,
            draggable: false,
            icon: atmIcon
        });

        if (innerWidth < 600) {
            utility.removeClass(menu,'active');
            utility.addClass(closeBtn,'active');
        }
    }

    function initMap() {
        var uluru = {lat: window.atm.position.coords.latitude, lng: window.atm.position.coords.longitude},
            icon = {
                path: "M204.583,216.671c50.664,0,91.74-48.075,91.74-107.378c0-82.237-41.074-107.377-91.74-107.377,c-50.668,0-91.74,25.14-91.74,107.377C112.844,168.596,153.916,216.671,204.583,216.671z,M407.164,374.717L360.88,270.454c-2.117-4.771-5.836-8.728-10.465-11.138l-71.83-37.392,c-1.584-0.823-3.502-0.663-4.926,0.415c-20.316,15.366-44.203,23.488-69.076,23.488c-24.877,0-48.762-8.122-69.078-23.488,c-1.428-1.078-3.346-1.238-4.93-0.415L58.75,259.316c-4.631,2.41-8.346,6.365-10.465,11.138L2.001,374.717,c-3.191,7.188-2.537,15.412,1.75,22.005c4.285,6.592,11.537,10.526,19.4,10.526h362.861c7.863,0,15.117-3.936,19.402-10.527,C409.699,390.129,410.355,381.902,407.164,374.717z",
                    fillColor: '#0e47a3',
                fillOpacity: 1,
                anchor: new google.maps.Point(200,200),
                strokeWeight: 0,
                scale: iconSize
            };

        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 13,
            center: uluru
        });

        currentLocation = new google.maps.Marker({
            position: uluru,
            map: map,
            draggable: false,
            icon: icon
        });
    }

    window.addEventListener("location-loaded", initMap);
    window.atm.map.showItem = showItem;

})();